@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Light Theme Colors - Cream Paper */
    --color-background: 249 247 242; /* #F9F7F2 - Cream Paper */
    --color-foreground: 15 23 42; /* #0F172A - Fountain Pen Ink */
    --color-accent: 107 114 128; /* #6B7280 - Slate Grey Metallic */
    --color-accent-secondary: 64 224 208; /* #40E0D0 - Turquoise (keep for compatibility) */
    --color-accent-cyan: 72 209 204; /* #48D1CC - Medium Turquoise (keep for compatibility) */

    /* Notebook Design System Colors */
    --notebook-divider: 229 224 214; /* #E5E0D6 - Subtle pencil mark */
    --notebook-binding: 107 114 128; /* #6B7280 - Slate Grey Metallic */

    /* Glassmorphism */
    --glass-bg: rgba(255, 255, 255, 0.5);
    --glass-border: rgba(255, 255, 255, 0.01);

    /* Border Radius */
    --radius-sm: 0.375rem; /* 6px */
    --radius-md: 0.5rem; /* 8px */
    --radius-lg: 0.75rem; /* 12px */
    --radius-xl: 1rem; /* 16px */

    /* Blur */
    --blur-sm: 4px;
    --blur-md: 8px;
    --blur-lg: 16px;

    /* Shadows - Layered Paper Effect */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 1px 3px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.01);
    --shadow-lg:
      0 1px 3px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.02),
      0 2px 4px rgba(0, 0, 0, 0.01);
    --shadow-xl:
      0 1px 3px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.02),
      0 20px 30px rgba(0, 0, 0, 0.03), 0 2px 4px rgba(0, 0, 0, 0.01);

    /* Accent-colored shadows removed - using paper shadows only */

    /* Spacing Scale (using Tailwind defaults) */
    --spacing-xs: 0.25rem; /* 4px */
    --spacing-sm: 0.5rem; /* 8px */
    --spacing-md: 1rem; /* 16px */
    --spacing-lg: 1.5rem; /* 24px */
    --spacing-xl: 2rem; /* 32px */
    --spacing-2xl: 3rem; /* 48px */
    --spacing-3xl: 4rem; /* 64px */

    /* Handwriting Border System - SVG Patterns */
    /* 
     * SVG patterns for hand-drawn/sketchy borders
     * Patterns use black color (#000) - will be colored via CSS mask/background-color
     * Patterns tile seamlessly for long borders
     * Optimized to < 500 bytes each
     * 
     * Usage: Use as mask-image with background-color, or as background-image with filter
     */

    /* Horizontal border pattern (for top/bottom borders) */
    /* Hand-drawn wavy line with slight variation - tiles seamlessly horizontally */
    /* Pattern width: 50px for good variation without being too repetitive */
    --handwriting-border-horizontal: url("data:image/svg+xml,%3Csvg%20width%3D%2250%22%20height%3D%222%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M0%2C1%20Q8%2C0.3%2015%2C1%20Q22%2C1.7%2030%2C1%20Q37%2C0.4%2045%2C1%20Q47%2C1.2%2050%2C1%22%20stroke%3D%22%23000%22%20stroke-width%3D%221.2%22%20fill%3D%22none%22%20stroke-linecap%3D%22round%22%2F%3E%3C%2Fsvg%3E");

    /* Vertical border pattern (for left/right borders) */
    /* Hand-drawn wavy line with slight variation - tiles seamlessly vertically */
    /* Pattern height: 50px for good variation */
    --handwriting-border-vertical: url("data:image/svg+xml,%3Csvg%20width%3D%222%22%20height%3D%2250%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M1%2C0%20Q0.3%2C8%201%2C15%20Q1.7%2C22%201%2C30%20Q0.4%2C37%201%2C45%20Q1.2%2C47%201%2C50%22%20stroke%3D%22%23000%22%20stroke-width%3D%221.2%22%20fill%3D%22none%22%20stroke-linecap%3D%22round%22%2F%3E%3C%2Fsvg%3E");

    /* Underline pattern (for text underlines) */
    /* Hand-drawn wavy underline with organic feel - tiles seamlessly */
    /* Pattern width: 35px for subtle variation */
    --handwriting-underline: url("data:image/svg+xml,%3Csvg%20width%3D%2235%22%20height%3D%222%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M0%2C1%20Q4%2C0.2%208%2C1%20Q12%2C1.6%2016%2C1%20Q20%2C0.3%2024%2C1%20Q28%2C1.5%2032%2C1%20Q33%2C1.1%2035%2C1%22%20stroke%3D%22%23000%22%20stroke-width%3D%221.5%22%20fill%3D%22none%22%20stroke-linecap%3D%22round%22%2F%3E%3C%2Fsvg%3E");
  }

  .dark {
    /* Dark Theme Colors - Obsidian Leather */
    --color-background: 20 20 20; /* #141414 - Obsidian Leather */
    --color-foreground: 249 247 242; /* #F9F7F2 - Cream text on dark */
    --color-accent: 156 163 175; /* #9CA3AF - Grey Metallic (lighter for dark theme) */
    --color-accent-secondary: 64 224 208; /* #40E0D0 - Turquoise (keep for compatibility) */
    --color-accent-cyan: 72 209 204; /* #48D1CC - Medium Turquoise (keep for compatibility) */

    /* Notebook Design System Colors - Dark Theme */
    --notebook-divider: 107 114 128; /* #6B7280 - Lighter grey for better visibility on dark background */
    --notebook-binding: 156 163 175; /* #9CA3AF - Grey Metallic (lighter for dark theme) */

    /* Glassmorphism for dark theme */
    --glass-bg: rgba(0, 0, 0, 0.5);
    --glass-border: rgba(255, 255, 255, 0.01);

    /* Shadows adjusted for dark theme - Layered Paper Effect */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 1px 3px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
    --shadow-lg:
      0 1px 3px rgba(0, 0, 0, 0.2), 0 10px 20px rgba(0, 0, 0, 0.15),
      0 2px 4px rgba(0, 0, 0, 0.1);
    --shadow-xl:
      0 1px 3px rgba(0, 0, 0, 0.2), 0 10px 20px rgba(0, 0, 0, 0.15),
      0 20px 30px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);

    /* Accent-colored shadows removed - using paper shadows only */
  }

  html {
    color-scheme: light dark;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings:
      'rlig' 1,
      'calt' 1;
    transition:
      background-color 0.3s ease,
      color 0.3s ease;
    position: relative;
  }

  /* Subtle page edge shadows for notebook authenticity */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    box-shadow:
      inset 0 0 20px rgba(0, 0, 0, 0.02),
      inset 0 0 40px rgba(0, 0, 0, 0.01);
  }

  .dark body::before {
    box-shadow:
      inset 0 0 20px rgba(0, 0, 0, 0.3),
      inset 0 0 40px rgba(0, 0, 0, 0.15);
  }

  /* Ensure main content is above page edge shadows */
  main {
    position: relative;
    z-index: 1;
  }

  /* Typography Utility Classes - Standardized font usage */
  .text-heading {
    @apply font-serif;
  }

  .text-body {
    @apply font-sans;
  }

  .text-code {
    @apply font-mono;
  }

  /* Typography Scale - Serif for headings, Sans for body */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply font-serif;
  }

  h1 {
    @apply text-4xl font-bold tracking-tight md:text-5xl lg:text-6xl xl:text-7xl;
  }

  h2 {
    @apply text-3xl font-bold tracking-tight md:text-4xl lg:text-5xl;
  }

  h3 {
    @apply text-2xl font-semibold tracking-tight md:text-3xl lg:text-4xl;
  }

  h4 {
    @apply text-xl font-semibold md:text-2xl;
  }

  h5 {
    @apply text-lg font-medium md:text-xl;
  }

  h6 {
    @apply text-base font-medium md:text-lg;
  }

  p,
  li,
  span,
  div,
  a,
  button {
    @apply font-sans;
  }

  /* Ensure select dropdowns use project font */
  select,
  select option {
    @apply font-sans;
    font-family: var(--font-solitreo), Georgia, serif;
  }

  p {
    @apply text-base leading-7;
  }

  code,
  pre {
    @apply font-mono;
  }

  code {
    @apply text-sm;
  }

  /* Base Component Styles */
  /* DEPRECATED: Glassmorphism classes - kept for rollback if needed
  .glass-panel {
    @apply backdrop-blur-lg bg-glass-bg border border-glass-border rounded-xl;
    box-shadow: var(--shadow-xl);
  }

  .glass-card {
    @apply glass-panel p-6 transition-all duration-300 hover:border-accent/40 hover:-translate-y-0.5;
    box-shadow: var(--shadow-xl);
  }
  
  .glass-card:hover {
    box-shadow: var(--shadow-xl);
  }
  */

  /* Stamped Button Style - Distinct pressed/stamped effect */
  .btn-primary,
  .btn-secondary,
  .btn-ghost {
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    @apply rounded-lg bg-accent px-4 py-2 font-medium text-foreground transition-all duration-200 hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 active:bg-accent/95;
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  /* Add subtle paper texture to buttons */
  .btn-primary::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 0;
    opacity: 0.1;
    border-radius: inherit;
  }

  .btn-primary > * {
    position: relative;
    z-index: 1;
  }

  .btn-primary:hover {
    transform: scale(0.98);
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 20px 30px rgba(0, 0, 0, 0.03),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  .btn-primary:active {
    transform: scale(0.96);
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.05),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  .btn-secondary {
    @apply rounded-lg border border-accent/20 bg-accent/10 px-4 py-2 font-medium text-accent transition-all duration-200 hover:border-accent/40 hover:bg-accent/20 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 active:bg-accent/25;
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  .btn-secondary::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 0;
    opacity: 0.1;
    border-radius: inherit;
  }

  .btn-secondary > * {
    position: relative;
    z-index: 1;
  }

  .btn-secondary:hover {
    transform: scale(0.98);
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 20px 30px rgba(0, 0, 0, 0.03),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  .btn-secondary:active {
    transform: scale(0.96);
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.05),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  .btn-ghost {
    @apply rounded-lg px-4 py-2 font-medium text-foreground transition-all duration-200 hover:bg-foreground/10 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 active:bg-foreground/15;
  }

  .btn-ghost::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 0;
    opacity: 0.05;
    border-radius: inherit;
  }

  .btn-ghost > * {
    position: relative;
    z-index: 1;
  }

  .btn-ghost:hover {
    transform: scale(0.98);
  }

  .btn-ghost:active {
    transform: scale(0.96);
  }

  /* Notebook Design System Utilities */

  /* Paper Texture Overlay - SVG noise pattern (theme-aware) */
  .paper-texture {
    position: relative;
  }

  .paper-texture::before {
    content: '';
    position: absolute;
    inset: 0;
    /* Enhanced paper grain pattern with variation */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 0;
    opacity: 0.05; /* Increased from 0.03 for better visibility */
    will-change: opacity; /* Optimize for theme transitions */
  }

  .dark .paper-texture::before {
    opacity: 0.03; /* Increased from 0.02 for better visibility in dark theme */
    mix-blend-mode: soft-light; /* Better blend mode for dark theme */
  }

  .paper-texture > * {
    position: relative;
    z-index: 1;
  }

  /* Performance: Use GPU acceleration for transforms */
  .loose-leaf-card,
  .notebook-panel {
    will-change: transform;
    backface-visibility: hidden; /* Force GPU acceleration without overriding transforms */
    -webkit-font-smoothing: antialiased;
  }

  /* Notebook Panel - Flat panel style (distinct from cards) */
  .notebook-panel {
    @apply rounded-lg bg-background;
    /* Remove regular border - using handwriting border instead */
    border: none;
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 2px 4px rgba(0, 0, 0, 0.01);
    position: relative;
    /* No rotation - flat panel style */
    transform: rotate(0deg);
  }

  /* Add handwriting border to notebook panel */
  /* Extend border area to cover rounded corners */
  .notebook-panel::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    border-radius: inherit;
    background-color: rgb(var(--notebook-divider));
    /* Use a two-layer mask: gradient masks for border shape + SVG patterns for handwriting texture */
    -webkit-mask-image: 
      /* Gradient masks define the border area (outer 2px on all sides) */
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      /* SVG pattern masks add handwriting texture within the border area */
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal),
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    -webkit-mask-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-x, repeat-y, repeat-y;
    -webkit-mask-position: top, bottom, left, right, top, bottom, left, right;
    -webkit-mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, auto 4px, auto 4px, 4px auto, 4px auto;
    -webkit-mask-composite: add;
    mask-image: 
      /* Gradient masks define the border area (outer 2px on all sides) */
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      /* SVG pattern masks add handwriting texture within the border area */
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal),
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    mask-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-x, repeat-y, repeat-y;
    mask-position: top, bottom, left, right, top, bottom, left, right;
    mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, auto 4px, auto 4px, 4px auto, 4px auto;
    mask-composite: add;
    pointer-events: none;
    z-index: 0;
  }

  /* Add subtle paper texture to panels */
  .notebook-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 1; /* Above border, below content */
    opacity: 0.03;
    border-radius: inherit;
  }

  .dark .notebook-panel::before {
    opacity: 0.02;
    mix-blend-mode: soft-light;
  }

  .notebook-panel > * {
    position: relative;
    z-index: 2; /* Above texture and border */
  }

  .notebook-panel:hover {
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 20px 30px rgba(0, 0, 0, 0.03),
      0 2px 4px rgba(0, 0, 0, 0.01);
    border-color: rgb(var(--notebook-divider) / 0.8);
  }

  /* Loose-Leaf Card - Cards with subtle rotation (distinct from panels) */
  .loose-leaf-card {
    @apply rounded-lg bg-background p-6 transition-all duration-300;
    /* Remove regular border - using handwriting border instead */
    border: none;
    position: relative;
    transform: rotate(0deg); /* No rotation on mobile */
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 2px 4px rgba(0, 0, 0, 0.01);
  }

  /* Add handwriting border to loose-leaf cards */
  /* Extend border area to cover rounded corners */
  .loose-leaf-card::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    border-radius: inherit;
    background-color: rgb(var(--notebook-divider));
    /* Use a two-layer mask: gradient masks for border shape + SVG patterns for handwriting texture */
    -webkit-mask-image: 
      /* Gradient masks define the border area (outer 2px on all sides) */
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      /* SVG pattern masks add handwriting texture within the border area */
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal),
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    -webkit-mask-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-x, repeat-y, repeat-y;
    -webkit-mask-position: top, bottom, left, right, top, bottom, left, right;
    -webkit-mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, auto 4px, auto 4px, 4px auto, 4px auto;
    -webkit-mask-composite: add;
    mask-image: 
      /* Gradient masks define the border area (outer 2px on all sides) */
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      /* SVG pattern masks add handwriting texture within the border area */
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal),
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    mask-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat-x, repeat-x, repeat-y, repeat-y;
    mask-position: top, bottom, left, right, top, bottom, left, right;
    mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, auto 4px, auto 4px, 4px auto, 4px auto;
    mask-composite: add;
    pointer-events: none;
    z-index: 0; /* Below texture and content */
  }

  /* Add paper texture to cards */
  .loose-leaf-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.95' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 1; /* Above border, below content */
    opacity: 0.05;
    border-radius: inherit;
  }

  .dark .loose-leaf-card::before {
    opacity: 0.03;
    mix-blend-mode: soft-light;
  }

  .loose-leaf-card > * {
    position: relative;
    z-index: 2; /* Above texture and border */
  }

  /* Add rotation on larger screens */
  @media (min-width: 768px) {
    .loose-leaf-card {
      transform: rotate(0.5deg);
    }
  }

  .loose-leaf-card:hover {
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 20px rgba(0, 0, 0, 0.02),
      0 20px 30px rgba(0, 0, 0, 0.03),
      0 2px 4px rgba(0, 0, 0, 0.01);
    border-color: rgb(var(--notebook-divider) / 0.8);
  }

  @media (min-width: 768px) {
    .loose-leaf-card:hover {
      transform: rotate(1deg) translateY(-4px); /* Full effect on desktop */
    }
  }

  @media (max-width: 767px) {
    .loose-leaf-card:hover {
      transform: translateY(-2px); /* Reduced effect on mobile */
    }
  }

  /* Notebook Binding - Vertical line on left edge */
  .notebook-binding {
    position: relative;
  }

  .notebook-binding::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 5px;
    background: linear-gradient(
      to right,
      rgb(var(--notebook-binding)),
      transparent
    );
    z-index: 0;
  }

  /* Pencil Divider - Enhanced to look like a drawn line */
  .pencil-divider {
    /* Remove regular border - using handwriting border instead */
    border: none;
    border-width: 0;
    position: relative;
  }

  /* Add handwriting border as top border */
  .pencil-divider::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: top;
    -webkit-mask-size: auto 1px;
    mask-image: var(--handwriting-border-horizontal);
    mask-repeat: repeat-x;
    mask-position: top;
    mask-size: auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  /* Remove old ::after pseudo-element that was creating gradient overlay */
  .pencil-divider::after {
    display: none;
  }

  /* Handwriting Border Classes */
  /* 
   * Uses pseudo-elements with SVG background images to support border-radius
   * Follows existing .paper-texture::before pattern for consistency
   * Z-index: border (0) < texture (0) < content (1)
   */

  /* All borders - handwriting style */
  /* Recommendation: Use handwriting-border-x + handwriting-border-y for better control */
  /* This implementation provides a basic all-border solution */
  .handwriting-border-all {
    position: relative;
    /* Keep original border as fallback for older browsers */
  }

  /* Top and bottom borders */
  .handwriting-border-all::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgb(var(--notebook-divider));
    background-image: 
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal);
    background-repeat: repeat-x, repeat-x;
    background-position: top, bottom;
    background-size: auto 1px, auto 1px;
    -webkit-mask-image: var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x, repeat-x;
    -webkit-mask-position: top, bottom;
    -webkit-mask-size: auto 1px, auto 1px;
    mask-image: var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal);
    mask-repeat: repeat-x, repeat-x;
    mask-position: top, bottom;
    mask-size: auto 1px, auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  /* Left and right borders */
  .handwriting-border-all::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    background-color: rgb(var(--notebook-divider));
    background-image: 
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    background-repeat: repeat-y, repeat-y;
    background-position: left, right;
    background-size: 1px auto, 1px auto;
    -webkit-mask-image: var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    -webkit-mask-repeat: repeat-y, repeat-y;
    -webkit-mask-position: left, right;
    -webkit-mask-size: 1px auto, 1px auto;
    mask-image: var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    mask-repeat: repeat-y, repeat-y;
    mask-position: left, right;
    mask-size: 1px auto, 1px auto;
    pointer-events: none;
    z-index: 0;
  }

  /* Top border only */
  .handwriting-border-t {
    position: relative;
  }

  .handwriting-border-t::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: top;
    -webkit-mask-size: auto 1px;
    mask-image: var(--handwriting-border-horizontal);
    mask-repeat: repeat-x;
    mask-position: top;
    mask-size: auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  /* Bottom border only */
  .handwriting-border-b {
    position: relative;
  }

  .handwriting-border-b::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: bottom;
    -webkit-mask-size: auto 1px;
    mask-image: var(--handwriting-border-horizontal);
    mask-repeat: repeat-x;
    mask-position: bottom;
    mask-size: auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  /* Bottom border with accent color variant (for active navigation states) */
  .handwriting-border-b-accent::before {
    background-color: rgb(var(--color-accent));
  }

  /* Left border only */
  .handwriting-border-l {
    position: relative;
  }

  .handwriting-border-l::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-vertical);
    -webkit-mask-repeat: repeat-y;
    -webkit-mask-position: left;
    -webkit-mask-size: 1px auto;
    mask-image: var(--handwriting-border-vertical);
    mask-repeat: repeat-y;
    mask-position: left;
    mask-size: 1px auto;
    pointer-events: none;
    z-index: 0;
  }

  /* Left border with accent color variant (for active mobile menu states) */
  .handwriting-border-l-accent::before {
    background-color: rgb(var(--color-accent));
  }

  .handwriting-border-r::before {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-vertical);
    -webkit-mask-repeat: repeat-y;
    -webkit-mask-position: right;
    -webkit-mask-size: 1px auto;
    mask-image: var(--handwriting-border-vertical);
    mask-repeat: repeat-y;
    mask-position: right;
    mask-size: 1px auto;
    pointer-events: none;
    z-index: 0;
  }

  /* Horizontal borders (top and bottom) */
  .handwriting-border-x {
    position: relative;
  }

  .handwriting-border-x::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: top;
    -webkit-mask-size: auto 1px;
    mask-image: var(--handwriting-border-horizontal);
    mask-repeat: repeat-x;
    mask-position: top;
    mask-size: auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  .handwriting-border-x::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-horizontal);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: bottom;
    -webkit-mask-size: auto 1px;
    mask-image: var(--handwriting-border-horizontal);
    mask-repeat: repeat-x;
    mask-position: bottom;
    mask-size: auto 1px;
    pointer-events: none;
    z-index: 0;
  }

  /* Vertical borders (left and right) */
  .handwriting-border-y {
    position: relative;
  }

  .handwriting-border-y::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-vertical);
    -webkit-mask-repeat: repeat-y;
    -webkit-mask-position: left;
    -webkit-mask-size: 1px auto;
    mask-image: var(--handwriting-border-vertical);
    mask-repeat: repeat-y;
    mask-position: left;
    mask-size: 1px auto;
    pointer-events: none;
    z-index: 0;
  }

  .handwriting-border-y::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 1px;
    background-color: rgb(var(--notebook-divider));
    -webkit-mask-image: var(--handwriting-border-vertical);
    -webkit-mask-repeat: repeat-y;
    -webkit-mask-position: right;
    -webkit-mask-size: 1px auto;
    mask-image: var(--handwriting-border-vertical);
    mask-repeat: repeat-y;
    mask-position: right;
    mask-size: 1px auto;
    pointer-events: none;
    z-index: 0;
  }

  /* Handwriting underline for text */
  .handwriting-underline {
    text-decoration: none;
    color: rgb(var(--color-accent-cyan)); /* Explicit text color fallback */
    background-color: rgb(var(--color-accent-cyan)); /* Explicit underline color */
    -webkit-mask-image: var(--handwriting-underline);
    -webkit-mask-repeat: repeat-x;
    -webkit-mask-position: bottom;
    -webkit-mask-size: auto 2px;
    mask-image: var(--handwriting-underline);
    mask-repeat: repeat-x;
    mask-position: bottom;
    mask-size: auto 2px;
    padding-bottom: 2px; /* Space for underline */
  }

  /* Utility class to add handwriting border to any element */
  /* Use this for buttons, badges, tags, and other components */
  .handwriting-border {
    position: relative;
    border: none !important; /* Remove regular border */
  }

  .handwriting-border::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border-radius: inherit;
    background-color: rgb(var(--notebook-divider));
    background-image: 
      var(--handwriting-border-horizontal),
      var(--handwriting-border-horizontal),
      var(--handwriting-border-vertical),
      var(--handwriting-border-vertical);
    background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
    background-position: top, bottom, left, right;
    background-size: auto 4px, auto 4px, 4px auto, 4px auto;
    /* Use a mask to show only the border area (outer 2px) */
    -webkit-mask-image: 
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%);
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-position: top, bottom, left, right;
    -webkit-mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%;
    -webkit-mask-composite: add;
    mask-image: 
      linear-gradient(to bottom, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to bottom, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%),
      linear-gradient(to right, transparent 0, black 1px, black 3px, transparent 3px),
      linear-gradient(to right, transparent calc(100% - 3px), black calc(100% - 3px), black calc(100% - 1px), transparent 100%);
    mask-repeat: no-repeat;
    mask-position: top, bottom, left, right;
    mask-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%;
    mask-composite: add;
    pointer-events: none;
    z-index: 0;
  }

  /* Handwriting border with accent color (for tags, badges, etc.) */
  .handwriting-border-accent::before {
    background-color: rgb(var(--color-accent) / 0.2);
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }

    /* Disable page transitions for reduced motion */
    .page-transition {
      transition: none !important;
    }
  }

  /* Print Styles */
  @media print {
    @page {
      margin: 1cm;
    }

    body {
      background: white;
      color: black;
    }

    .glass-card,
    .glass-panel,
    .loose-leaf-card,
    .notebook-panel {
      background: white !important;
      border: 1px solid #e5e7eb !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
      transform: none !important;
      page-break-inside: avoid;
    }

    .paper-texture::before {
      display: none !important;
    }

    .notebook-binding {
      display: none !important;
    }

    header,
    footer,
    nav {
      display: none !important;
    }

    a {
      color: #000 !important;
      text-decoration: underline;
    }

    a[href^='http']:after {
      content: ' (' attr(href) ')';
      font-size: 0.8em;
      color: #666;
    }

    h1,
    h2,
    h3 {
      page-break-after: avoid;
    }

    .no-print {
      display: none !important;
    }
  }
}
