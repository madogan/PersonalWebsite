---
alwaysApply: true
---

# Next.js 15+ Rules for THOF Project

## NextJS 15+ Best Practices

### App Router Structure

- âœ… Use App Router exclusively (not Pages Router)
- âœ… Follow the `app/` directory structure with proper nesting
- âœ… Use Server Components by default, Client Components only when needed
- âœ… **REQUIRED**: Implement error.tsx, not-found.tsx for all route segments
- âœ… Use route groups `(public)` for organization
- âœ… Use static `export const metadata` for static pages; use `generateMetadata` for dynamic routes

### Server Components & Client Components

```typescript
// âœ… Server Component (default) - Modern pattern
export default async function ServerComponent() {
  const data = await fetchData()
  return <div>Server-rendered: {data}</div>
}

// âœ… Client Component (explicit) - Only when needed
'use client'
export default function ClientComponent() {
  const [state, setState] = useState()
  return <div>Interactive content</div>
}

// âŒ AVOID: React.FC (deprecated pattern)
const Component: React.FC<Props> = () => {} 

// âœ… USE: Modern function declarations
export function Component(props: Props) {}
```

### Metadata & Params Handling (Next.js 15+ Best Practices)

```typescript
// âœ… CORRECT: Static metadata for static pages
export const metadata: Metadata = {
  title: 'Page Title',
  description: 'Page description',
};

// âœ… CORRECT: generateMetadata for dynamic routes (Next.js 15+)
// Params MUST be Promise-typed in Next.js 15+ for dynamic routes
export async function generateMetadata({ params }: { params: Promise<{ slug: string }> }): Promise<Metadata> {
  const { slug } = await params // âœ… Always await params
  const post = getPostBySlug(slug)
  
  return {
    title: post.title,
    description: post.description,
  }
}

// âœ… CORRECT: Dynamic route params are Promise-typed in Next.js 15+
export default async function Page({ params }: { params: Promise<{ slug: string }> }) {
  const { slug } = await params // âœ… Always await params
  /* ... */
}

// âœ… CORRECT: Static route params (if not using dynamic segments)
export default async function StaticPage({ params }: { params: { locale: string } }) {
  const { locale } = params // No await needed for static params
  /* ... */
}

// âŒ AVOID: Not awaiting Promise-typed params
// export default async function Page({ params }: { params: Promise<{ slug: string }> }) {
//   const { slug } = params // âŒ WRONG: Must await Promise-typed params
// }
```

### Suspense Usage Rules

```typescript
// âœ… CORRECT: Suspense for code splitting
const LazyComponent = lazy(() => import('./Component'))
<Suspense fallback={<Loading />}>
  <LazyComponent />
</Suspense>

// âŒ WRONG: Suspense around client components
<Suspense fallback={<Loading />}>
  <ClientComponentWithOwnLoading /> {/* Already handles loading */}
</Suspense>

// âœ… CORRECT: Client components handle their own loading
export function ClientList() {
  const [loading, setLoading] = useState(true)
  if (loading) return <LoadingSpinner />
  return <div>Content</div>
}
```

### Error Handling & Boundaries

```typescript
// âœ… REQUIRED: error.tsx in each route segment
'use client'
export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
      <Card className="max-w-md w-full p-8 text-center">
        <h1 className="text-2xl font-bold mb-4">Bir Hata OluÅŸtu</h1>
        <p className="text-gray-600 mb-6">
          ÃœzgÃ¼nÃ¼z, beklenmeyen bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.
        </p>
        <Button onClick={reset}>Tekrar Dene</Button>
      </Card>
    </div>
  )
}
```

- âœ… **REQUIRED**: Create error.tsx files for each route segment
- âœ… Use proper error boundaries with reset functionality
- âœ… Implement user-friendly error messages
- âœ… Log errors appropriately for debugging

### Data Fetching

- âœ… Use async Server Components for data fetching
- âœ… Implement proper error boundaries
- âœ… Use Suspense ONLY for legitimate streaming/lazy loading
- âœ… Cache data appropriately with `cache()` and `unstable_cache()`
- âœ… Use `generateMetadata` for dynamic route metadata; use static `metadata` export for static pages

### Performance Optimizations

- âœ… Use `next/image` with proper sizing and optimization
- âœ… Define static metadata via `export const metadata` for static pages
- âœ… Use `generateMetadata` for dynamic route metadata (required for per-route SEO)
- âœ… Use streaming with Suspense (for appropriate use cases)
- âœ… Optimize bundle size with dynamic imports for code splitting

## ğŸš€ Next.js 15+ Configuration

### Modern Configuration (Turbopack Stable)

```typescript
// âœ… CORRECT: Next.js 15+ config
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  // Production optimizations
  output: 'standalone',
  compress: true,
  
  // Image configuration
  images: {
    // Enable optimization when possible
    unoptimized: false, // Only true if deployment requires it
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**',
      },
    ],
  },
  
  // Build quality policy (non-strict builds for now)
  typescript: {
    ignoreBuildErrors: true,
  },
  eslint: {
    ignoreDuringBuilds: true,
  },
  
  experimental: {
    // Keep empty unless using documented, stable experimental flags
  },
}

// âŒ INVALID: Unrecognized keys under unsupported sections will fail
// Do not add undocumented keys (e.g., custom turbopack options)
```

### Turbopack Usage Rules (September 2025)

- âœ… Development
  - Prefer Turbopack for dev: `pnpm dev` already passes `--turbopack`
  - If you hit a Turbopack-specific issue: temporarily use `next dev` without the flag for diagnosis, then revert
- âœ… Production
  - Use `next build` (Turbopack pipeline under the hood in Next.js 15+)
  - Do not add `turbopack` custom keys in `next.config.ts` (unsupported)
- âœ… Caching & Performance
  - Keep `output: 'standalone'` and `compress: true`
  - Rely on default incremental rebuilds; avoid custom Turbopack tuning keys
- ğŸ”§ Troubleshooting
  - Clear caches on odd rebuilds: delete `.next/` and rerun
  - For dependency graph issues, try `bash ./scripts/clean-install.sh`
  - Validate TS/ESLint separately: `pnpm type-check`, `pnpm lint`
  - If a transformation bug is suspected, compare behavior with `next dev` (no `--turbopack`) and file an upstream issue

### Development Commands

```bash
# âœ… Use Turbo by default
pnpm dev              # Uses --turbopack automatically
pnpm build            # Production build with Turbo
pnpm type-check       # TypeScript validation
pnpm lint             # ESLint validation
```

### Component Patterns

```typescript
// âœ… CORRECT: Modern function components
export function MyComponent({ title }: { title: string }) {
  return <h1>{title}</h1>
}

export default function MyPage() {
  return <div>Page content</div>
}

// âŒ AVOID: Deprecated React.FC
const MyComponent: React.FC<Props> = ({ title }) => {
  return <h1>{title}</h1>
}
```

## ğŸŒ Internationalization

### i18n Best Practices

- âœ… Use next-intl for internationalization
- âœ… Structure components for i18n from the start
- âœ… Externalize all user-facing strings
- âœ… Use semantic keys for translations
- âœ… Consider RTL language support

### i18n Implementation

```typescript
// âœ… CORRECT: Server component with translations
import { useTranslations } from 'next-intl'

export default function ServerPage() {
  const t = useTranslations('page')
  return <h1>{t('title')}</h1>
}

// âœ… CORRECT: Client component with translations
'use client'
import { useTranslations } from 'next-intl'

export function ClientComponent() {
  const t = useTranslations('component')
  return <button>{t('submit')}</button>
}
```

## ğŸ“Š Performance & Monitoring

### Core Web Vitals

- âœ… Monitor LCP (Largest Contentful Paint)
- âœ… Track FID (First Input Delay)
- âœ… Measure CLS (Cumulative Layout Shift)
- âœ… Use Next.js built-in analytics

### Performance Optimizations

```typescript
// âœ… CORRECT: Optimized images
import Image from 'next/image'

<Image
  src="/image.jpg"
  alt="Description"
  width={800}
  height={600}
  sizes="(max-width: 768px) 100vw, 50vw"
  priority // For above-the-fold images
/>

// âœ… CORRECT: Dynamic imports for code splitting
import dynamic from 'next/dynamic'

const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <Loading />,
  ssr: false // If client-only
})
```

## ğŸš€ Deployment & DevOps

### Environment Management

- âœ… Use .env files for configuration
- âœ… Validate environment variables at startup
- âœ… Never commit secrets to version control
- âœ… Use different configs for dev/staging/prod

### Docker Best Practices

- âœ… Use multi-stage builds
- âœ… Optimize image sizes
- âœ… Follow security best practices
- âœ… Use proper environment variables

## ğŸ“ Code Quality

### TypeScript Best Practices

- âœ… Use strict TypeScript configuration
- âœ… Define proper types for all props
- âœ… Avoid `any` type usage
- âœ… Use proper generic constraints

### Testing Patterns

- âœ… Write unit tests for utilities
- âœ… Integration tests for API routes
- âœ… E2E tests for critical user flows
- âœ… Use proper mocking strategies

---
description: Next.js 15+ best practices and patterns for the THOF project
globs: ["**/*.tsx", "**/*.ts", "next.config.ts", "**/*.mdc"]
alwaysApply: true
---